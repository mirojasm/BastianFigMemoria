<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="resources/css/styleretroalimentacion.css">
    <title>Mi Aplicación</title>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-content">
            <h2>Bienvenido, <span id="username">Usuario</span> de <span id="userSchool">Colegio</span></h2>
            <div class="nav-buttons">
                <button id="cerrarSesion">Cerrar Sesión</button>
            </div>
        </div>
    </nav>

    <div class="main-container">
        <!-- Contenedor para las tarjetas de retroalimentación -->
        <div class="levels-container" id="feedbackContainer">
            <!-- Las tarjetas se generarán dinámicamente mediante JavaScript -->
        </div>
    </div>

    <script>
        // Configuración de los tipos de retroalimentación y sus rangos de ID
        const tiposRetroalimentacion = [
            {
                rangoId: { min: 1, max: 10 },
                titulo: "Retroalimentación autonoma (general)",
                descripcion: "Esta retroalimentación esta orientada solamente para que observes si en las actividades que has respondido, has respondido como se esperaba o no.",
                ruta: "/feedback"
            },
            {
                rangoId: { min: 11, max: 20 },
                titulo: "Retroalimentacion elaborado",
                descripcion: "Esta retroalimentación esta orientada a indicarte de manera mas extensa en base a tus respuestas que necesitas para mejorar las habilidades de pensamiento critico.",
                ruta: "/feedback-elaborado"
            },
            {
                rangoId: { min: 21, max: 30 },
                titulo: "Retroalimentacion Acumulativa",
                descripcion: "Esta retroalimentacion esta orientada a indicarte de manera mas extensa y personalizada en base a patrones que has tenido durante el desarrollo de estas actividades.",
                ruta: "/feedback-acumulativo"
            }
        ];

        // Función para obtener la información del usuario
        const obtenerInfoUsuario = () => {
            const infoUsuario = localStorage.getItem('userInfo');
            return infoUsuario ? JSON.parse(infoUsuario) : null;
        };

        // Función para mostrar la información del usuario en la barra de navegación
        const mostrarInfoUsuario = () => {
            const infoUsuario = obtenerInfoUsuario();
            if (infoUsuario) {
                document.getElementById('username').textContent = infoUsuario.nombre || 'Usuario';
                document.getElementById('userSchool').textContent = infoUsuario.establecimiento || 'Colegio';
                renderizarTarjetasRetroalimentacion(infoUsuario.id);
            }
        };

        // Función para renderizar las tarjetas de retroalimentación según el ID del usuario
        const renderizarTarjetasRetroalimentacion = (idUsuario) => {
            const contenedor = document.getElementById('feedbackContainer');
            contenedor.innerHTML = ''; // Limpiar el contenedor

            tiposRetroalimentacion.forEach(retroalimentacion => {
                if (idUsuario >= retroalimentacion.rangoId.min && idUsuario <= retroalimentacion.rangoId.max) {
                    const tarjeta = `
                        <div class="level-card">
                            <h3>${retroalimentacion.titulo}</h3>
                            <div class="description-container">
                                <p>${retroalimentacion.descripcion}</p>
                            </div>
                            <a href="${retroalimentacion.ruta}" class="button">Ingresar</a>
                        </div>
                    `;
                    contenedor.innerHTML += tarjeta;
                }
            });

            // Si no hay tarjetas disponibles para el usuario, mostrar un mensaje
            if (contenedor.children.length === 0) {
                contenedor.innerHTML = `
                    <div class="no-feedback-message">
                        <p>No hay retroalimentaciones disponibles para tu usuario en este momento.</p>
                    </div>
                `;
            }
        };

        // Función para cerrar sesión
        const cerrarSesion = () => {
            localStorage.removeItem('userInfo');
            localStorage.removeItem('token');
            window.location.href = '/login';
        };

        // Inicialización cuando el DOM está listo
        document.addEventListener('DOMContentLoaded', () => {
            mostrarInfoUsuario();
            document.getElementById('cerrarSesion').addEventListener('click', cerrarSesion);
        });
    </script>
</body>
</html>